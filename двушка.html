<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ö–æ—Ñ–µ-–¥—Ä–æ–º: –û–±–≥–æ–Ω</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: #111;
      font-family: system-ui, sans-serif;
      color: #fff;
      overflow: hidden;
      touch-action: none;
    }
    #game {
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
      background: radial-gradient(circle at top, #333 0, #111 60%);
    }

    /* –î–æ—Ä–æ–≥–∞ */
    #road {
      position: absolute;
      width: 70vw;
      max-width: 420px;
      height: 100%;
      background: #222;
      left: 50%;
      transform: translateX(-50%);
      border-left: 6px solid #777;
      border-right: 6px solid #777;
      overflow: hidden;
    }

    /* –†–∞–∑–º–µ—Ç–∫–∞ */
    .lane-line {
      position: absolute;
      width: 4px;
      height: 40px;
      background: #ddd;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0.7;
    }

    /* –ú–∞—à–∏–Ω–∞ –∏–≥—Ä–æ–∫–∞ (–ø–æ–¥–Ω—è—Ç–∞ –≤—ã—à–µ, —á—Ç–æ–±—ã –µ—ë –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–∏ –ø–∞–ª—å—Ü—ã) */
    #raceCar {
      position: absolute;
      width: 40px;
      height: 70px;
      background: #00c853;
      bottom: 110px; /* –ë–´–õ–û 20px ‚Äî —Ç–µ–ø–µ—Ä—å –º–∞—à–∏–Ω–∞ –Ω–∞–º–Ω–æ–≥–æ –≤—ã—à–µ */
      left: 50%;
      transform: translateX(-50%);
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      display: none;
    }

    /* –í—Ä–∞–∂–µ—Å–∫–∏–µ –º–∞—à–∏–Ω—ã */
    .enemy {
      position: absolute;
      width: 40px;
      height: 70px;
      background: #e53935;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
    }

    /* HUD */
    #hud {
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 16px;
      font-size: 16px;
      z-index: 5;
      text-shadow: 0 0 4px #000;
    }

    /* –û–≤–µ—Ä–ª–µ–∏ */
    .overlay {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.75);
      z-index: 10;
      text-align: center;
      padding: 20px;
    }

    /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π —Ç–µ–∫—Å—Ç–∞ */
    #introScreen {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    #introScreen h1 {
      font-size: 26px;
      margin-bottom: 4px;
    }
    .intro-text {
      font-size: 18px;
      max-width: 280px;
      margin: 0 auto;
      opacity: 0;
      animation: fadeUp 2.2s ease-out forwards;
    }
    @keyframes fadeUp {
      0%   { opacity: 0; transform: translateY(16px); }
      60%  { opacity: 1; transform: translateY(0); }
      100% { opacity: 1; transform: translateY(0); }
    }

    button {
      border: none;
      padding: 10px 20px;
      border-radius: 999px;
      font-size: 16px;
      margin-top: 10px;
      background: #ffb300;
      color: #000;
      font-weight: 600;
    }
    button:active {
      transform: scale(0.96);
    }

    /* –≠–∫—Ä–∞–Ω Game Over */
    #gameOver {
      flex-direction: column;
      gap: 8px;
    }

    /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    #raceControls {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
      z-index: 6;
    }
    .ctrl-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      background: rgba(255,255,255,0.12);
      color: #fff;
      font-size: 28px;
    }
  </style>
</head>
<body>
<div id="game">
  <div id="road">
    <div id="raceCar"></div>
  </div>

  <div id="hud">
    <div>–û–±–æ–≥–Ω–∞–ª: <span id="score">0</span></div>
    <div>–°–∫–æ—Ä–æ—Å—Ç—å: <span id="speed">1</span>x</div>
  </div>

  <!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –Ω–∞–¥–ø–∏—Å–∏ -->
  <div id="introScreen" class="overlay" style="display:flex;">
    <div>
      <h1>–ö–æ—Ñ–µ-–¥—Ä–æ–º ‚òïüèÅ</h1>
      <p class="intro-text">
        –û–±—ä–µ–∑–∂–∞–π –º–∞—à–∏–Ω—ã, –ø–æ–∫–∞ –∂–¥—ë—à—å —Å–≤–æ–π –∫–æ—Ñ–µ.
      </p>
      <button id="introBtn">–ü–æ–µ—Ö–∞–ª–∏</button>
    </div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω Game Over -->
  <div id="gameOver" class="overlay">
    <h2>–§–∏–Ω–∏—à!</h2>
    <p>–¢—ã –æ–±–æ–≥–Ω–∞–ª –º–∞—à–∏–Ω: <span id="finalScore">0</span></p>
    <p id="comment"></p>

    <div style="display:flex;flex-direction:column;gap:8px;margin-top:10px;">
      <button id="coffeeNotReadyBtn" style="background:#ffb300;">–ö–æ—Ñ–µ –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤</button>
      <button id="coffeeReadyBtn" style="background:#00e676;">–ö–æ—Ñ–µ –≥–æ—Ç–æ–≤</button>
      <button id="restartBtn" style="background:#ccc;">–ù–æ–≤—ã–π –∑–∞–µ–∑–¥</button>
    </div>

    <p id="coffeeMsg" style="margin-top:10px;font-size:16px;font-weight:500;"></p>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
  <div id="raceControls">
    <button class="ctrl-btn" id="leftBtn">‚óÄ</button>
    <button class="ctrl-btn" id="rightBtn">‚ñ∂</button>
  </div>
</div>

<script>
  const road = document.getElementById('road');
  const raceCar = document.getElementById('raceCar');
  const scoreEl = document.getElementById('score');
  const speedEl = document.getElementById('speed');

  const introScreen = document.getElementById('introScreen');
  const introBtn = document.getElementById('introBtn');

  const gameOver = document.getElementById('gameOver');
  const finalScoreEl = document.getElementById('finalScore');
  const commentEl = document.getElementById('comment');
  const coffeeMsg = document.getElementById('coffeeMsg');
  const coffeeNotReadyBtn = document.getElementById('coffeeNotReadyBtn');
  const coffeeReadyBtn = document.getElementById('coffeeReadyBtn');
  const restartBtn = document.getElementById('restartBtn');

  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');

  // —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
  let laneLines = [];
  let enemies = [];
  let score = 0;
  let speed = 3;
  let maxSpeed = 9;
  let lastSpawn = 0;
  let spawnInterval = 900;
  let moveDirection = 0;
  const moveStep = 6;
  let running = false;
  let lastTime = 0;

  function createLaneLines() {
    const roadRect = road.getBoundingClientRect();
    const count = Math.ceil(roadRect.height / 80) + 2;
    laneLines.forEach(l => l.remove());
    laneLines = [];
    for (let i = 0; i < count; i++) {
      const line = document.createElement('div');
      line.className = 'lane-line';
      line.style.top = i * 80 + 'px';
      road.appendChild(line);
      laneLines.push(line);
    }
  }

  function resetRaceCar() {
    const rect = road.getBoundingClientRect();
    const carWidth = raceCar.offsetWidth;
    raceCar.style.left = (rect.width / 2 - carWidth / 2) + 'px';
  }

  function spawnEnemy() {
    const enemy = document.createElement('div');
    enemy.className = 'enemy';
    const rect = road.getBoundingClientRect();

    const lanes = [rect.width * 0.2, rect.width * 0.5, rect.width * 0.8];
    const lane = lanes[Math.floor(Math.random() * lanes.length)];
    enemy.style.left = (lane - enemy.offsetWidth / 2) + 'px';
    enemy.style.top = '-90px';

    road.appendChild(enemy);
    enemies.push({ el: enemy, y: -90 });
  }

  function isColliding(a, b) {
    return !(
      a.right < b.left ||
      a.left > b.right ||
      a.bottom < b.top ||
      a.top > b.bottom
    );
  }

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–ª—å—Ü–µ–º (–ø–æ –¥–æ—Ä–æ–≥–µ)
  road.addEventListener('pointermove', e => {
    if (!running) return;
    const rect = road.getBoundingClientRect();
    let x = e.clientX - rect.left - raceCar.offsetWidth / 2;
    x = Math.max(0, Math.min(x, rect.width - raceCar.offsetWidth));
    raceCar.style.left = x + 'px';
  });

  // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  leftBtn.addEventListener('pointerdown', () => { moveDirection = -1; });
  rightBtn.addEventListener('pointerdown', () => { moveDirection = 1; });
  ['pointerup','pointerleave','pointercancel'].forEach(ev => {
    leftBtn.addEventListener(ev, () => moveDirection = 0);
    rightBtn.addEventListener(ev, () => moveDirection = 0);
  });

  function moveRaceCarButtons() {
    if (!running) return;
    const rect = road.getBoundingClientRect();
    let x = raceCar.offsetLeft + moveDirection * moveStep;
    x = Math.max(0, Math.min(x, rect.width - raceCar.offsetWidth));
    raceCar.style.left = x + 'px';
  }

  function updateGame(timestamp, delta) {
    // —Ä–∞–∑–º–µ—Ç–∫–∞
    laneLines.forEach(line => {
      let top = parseFloat(line.style.top);
      top += speed * 2;
      const roadRect = road.getBoundingClientRect();
      if (top > roadRect.height) top = -40;
      line.style.top = top + 'px';
    });

    moveRaceCarButtons();

    const roadRect = road.getBoundingClientRect();
    const playerRect = raceCar.getBoundingClientRect();

    for (let i = enemies.length - 1; i >= 0; i--) {
      const obj = enemies[i];
      obj.y += speed * 2.2;
      obj.el.style.top = obj.y + 'px';

      const enemyRect = obj.el.getBoundingClientRect();
      if (isColliding(playerRect, enemyRect)) {
        endGame();
        return;
      }

      if (obj.y > roadRect.height + 100) {
        obj.el.remove();
        enemies.splice(i, 1);
        score++;
        scoreEl.textContent = score;

        if (score > 0 && score % 10 === 0 && speed < maxSpeed) {
          speed += 0.01;
          speedEl.textContent = speed.toFixed(1);
          spawnInterval = Math.max(450, spawnInterval - 0.1);
        }
      }
    }

    if (timestamp - lastSpawn > spawnInterval) {
      spawnEnemy();
      lastSpawn = timestamp;
    }
  }

  function gameLoop(timestamp) {
    if (!running) return;
    const delta = timestamp - lastTime;
    lastTime = timestamp;

    updateGame(timestamp, delta);

    requestAnimationFrame(gameLoop);
  }

  function startGame() {
    enemies.forEach(e => e.el.remove());
    enemies = [];
    score = 0;
    speed = 3;
    spawnInterval = 900;
    moveDirection = 0;
    scoreEl.textContent = score;
    speedEl.textContent = '1';

    createLaneLines();
    raceCar.style.display = 'block';
    resetRaceCar();

    gameOver.style.display = 'none';
    running = true;
    lastTime = performance.now();
    lastSpawn = lastTime;
    requestAnimationFrame(gameLoop);
  }

  function endGame() {
    running = false;
    finalScoreEl.textContent = score;
    let text = '';
    if (score < 10) text = '–ü–æ—Ö–æ–∂–µ, —Ç—ã —Ç–æ–ª—å–∫–æ –≤—ã–µ—Ö–∞–ª –∏–∑ –±–æ–∫—Å–∞.';
    else if (score < 25) text = '–ù–µ–ø–ª–æ—Ö–æ –≤–æ–¥–∏—à—å! üëå';
    else text = '–¢—ã –Ω–∞—Å—Ç–æ—è—â–∏–π –ø–∏–ª–æ—Ç –∞–≤—Ç–æ–¥—Ä–æ–º–∞! üòé';

    commentEl.textContent = text;
    coffeeMsg.textContent = '';
    gameOver.style.display = 'flex';
  }

  // –ö–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–æ–∏–≥—Ä—ã—à–∞
  coffeeNotReadyBtn.onclick = () => {
    coffeeMsg.textContent = '–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑, –µ—Å–ª–∏ –∫–æ—Ñ–µ –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤ ‚òï';
    setTimeout(() => {
      startGame();
    }, 1200);
  };

  coffeeReadyBtn.onclick = () => {
    coffeeMsg.textContent = '–ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –Ω–∞–ø–∏—Ç–∫–æ–º ‚òï';
  };

  restartBtn.onclick = () => {
    coffeeMsg.textContent = '';
    startGame();
  };

  // –ò–Ω—Ç—Ä–æ -> —Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã
  introBtn.onclick = () => {
    introScreen.style.display = 'none';
    startGame();
  };

  // –∞–Ω—Ç–∏-–∂–µ—Å—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
  document.addEventListener('gesturestart', e => e.preventDefault());
</script>
</body>
</html>
